---
layout: post
title: 메모리 관리와 동적 할당
description: >
  메모리관리와 동적 할당에 대해 알아보자.
hide_description: true
sitemap: false
date: 2021-03-20 22:45:00 +0900
category: language
tag: [c]
---

# 메모리 관리와 동적 할당

## C 언어의 메모리 구조

### 스택, 힙 그리고 데이터 영역

* 프로그램의 실행을 위해 기본적으로 할당하는 메모리 공간
* 컴파일 타임에 함수에서 요구하는 스택의 크기가 결정되어야 한다.

![메모리공간 할당](/assets/img/language/c/memory.png)
{:.lead loading="lazy" align="center"}

메모리공간의 관리
{:.figcaption}

1. 데이터 영역 : 전역변수, Static변수, 고정적인 크기 할당(정적)
2. 스택(Stack) 영역 : 지역변수, 매개변수 등, 프로그램이 진행되면서 메모리 사용공간이 시시각각 변함(동적)
3. 힙(Heap) 영역 : 프로그래머가 할당한 것

* 메모리공간(스택) 사용 과정 예시

    1. 아래 그림과 같은 소스코드가 있다.
        ![예시](/assets/img/language/c/memory_assignment.png)
        {:.lead loading="lazy" align="center"}
    2. 먼저 전역변수로 설정된 `int a, b`를 데이터 영역에 초기화한다.
        ![예시](/assets/img/language/c/memory_assignment2.png)
        {:.lead loading="lazy" align="center"}
    3. 그 후 main함수에 지역변수로 선언된 `int m=123`을 스택 영역에 할당한다.
        ![예시](/assets/img/language/c/memory_assignment3.png)
        {:.lead loading="lazy" align="center"}
    4. 함수 `fct1()`을 호출하고 스택 공간에 매개변수 `c`와 지역변수 `d`를 할당한다.
        ![예시](/assets/img/language/c/memory_assignment4.png)
        {:.lead loading="lazy" align="center"}
    5. 함수 `fct1()`이 종료되면 스택 공간에 할당했던 지역변수 `c, d`를 pop up한다.
        ![예시](/assets/img/language/c/memory_assignment5.png)
        {:.lead loading="lazy" align="center"}
    6. 함수 `fct2()`를 호출하고 스택 공간에 `e, f` 변수들을 할당한다.
        ![예시](/assets/img/language/c/memory_assignment6.png)
        {:.lead loading="lazy" align="center"}
    7. 함수가 종료되면 할당했던 변수들을 pop up한다.
        ![예시](/assets/img/language/c/memory_assignment7.png)
        {:.lead loading="lazy" align="center"}
    8. 그 후 `return 0;`문에 의해 main함수가 종료되고, 지역변수로 있던 `m`을 pop up한다.
        ![예시](/assets/img/language/c/memory_assignment8.png)
        {:.lead loading="lazy" align="center"}
    9. 프로그램의 종료와 동시에 데이터 영역에 전역변수로 할당되어 있던 변수들을 삭제한다.
        ![예시](/assets/img/language/c/memory_assignment9.png)
        {:.lead loading="lazy" align="center"}

### 배열의 선언

* 배열의 길이 선언은 상수이다.
* 컴파일 타임에 스택 공간에 얼마의 메모리가 필요한지를 알아야 하므로 길이를 상수로 선언해주어야 한다.

변수를 선언하고 그 안에 상수를 저장한 후 배열의 길이를 해당 변수로 선언하더라도 불가능하다. 컴파일러는 해당 변수에 저장된 값이 무엇인지는 관심이 없고 type에 대해서만 알고 있는 상태이므로, 컴파일 타임에 배열의 크기를 계산할 수 없다.

## 메모리 동적 할당

### 메모리 동적 할당

* 런타임에 메모리 공간의 크기를 결정지어서 할당(힙 영역에 할당)

```c
#include <stdio.h>

void* malloc(size_t size)
```

### 동적 할당 된 메모리 공간의 소멸

```c
#include <stdio.h>

void free(void* ptr)
```